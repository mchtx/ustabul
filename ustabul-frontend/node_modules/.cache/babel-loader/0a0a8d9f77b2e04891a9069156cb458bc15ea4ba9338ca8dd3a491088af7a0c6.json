{"ast":null,"code":"import React,{createContext,useState,useEffect}from'react';import{usersAPI}from'./api';import{jsx as _jsx}from\"react/jsx-runtime\";export const AuthContext=/*#__PURE__*/createContext();export function AuthProvider(_ref){let{children}=_ref;const[user,setUser]=useState(null);const[isLoading,setIsLoading]=useState(true);useEffect(()=>{// Page yüklendiğinde user bilgisini localStorage'dan geri yükle\nconst userId=localStorage.getItem('user_id');const username=localStorage.getItem('username');if(userId&&username){setUser({id:parseInt(userId),username:username});}// CSRF token'ı her zaman al (başlangıçta ve login sonrasında)\nfetch('http://localhost:8000/api/csrf-token/').then(res=>res.json()).then(data=>{if(data.csrfToken){localStorage.setItem('csrfToken',data.csrfToken);}}).catch(err=>console.warn('CSRF token alınamadı:',err));setIsLoading(false);},[]);const login=async(username,password)=>{try{const response=await usersAPI.login(username,password);// Backend user bilgisini döndüğü için bunu sakla\nsetUser(response.data);localStorage.setItem('user_id',response.data.id);localStorage.setItem('username',response.data.username);// CSRF token'ı al\ntry{const csrfResponse=await fetch('http://localhost:8000/api/csrf-token/');const csrfData=await csrfResponse.json();if(csrfData.csrfToken){localStorage.setItem('csrfToken',csrfData.csrfToken);}}catch(csrfError){console.warn('CSRF token alınamadı:',csrfError);}return true;}catch(error){var _error$response;console.error('Giriş hatası:',((_error$response=error.response)===null||_error$response===void 0?void 0:_error$response.data)||error.message);return false;}};const register=async data=>{try{const response=await usersAPI.register(data);// Kaydolduktan hemen sonra login yap\nsetUser(response.data);localStorage.setItem('user_id',response.data.id);localStorage.setItem('username',response.data.username);return true;}catch(error){var _error$response2;console.error('Kayıt hatası:',((_error$response2=error.response)===null||_error$response2===void 0?void 0:_error$response2.data)||error.message);return false;}};const logout=()=>{// Session-based auth olduğu için localStorage'ı temizle\nlocalStorage.removeItem('user_id');localStorage.removeItem('username');localStorage.removeItem('access_token');setUser(null);};return/*#__PURE__*/_jsx(AuthContext.Provider,{value:{user,isLoading,login,register,logout},children:children});}","map":{"version":3,"names":["React","createContext","useState","useEffect","usersAPI","jsx","_jsx","AuthContext","AuthProvider","_ref","children","user","setUser","isLoading","setIsLoading","userId","localStorage","getItem","username","id","parseInt","fetch","then","res","json","data","csrfToken","setItem","catch","err","console","warn","login","password","response","csrfResponse","csrfData","csrfError","error","_error$response","message","register","_error$response2","logout","removeItem","Provider","value"],"sources":["C:/Users/mcht7/Desktop/TEZ AGENT/ustabul-frontend/src/AuthContext.js"],"sourcesContent":["import React, { createContext, useState, useEffect } from 'react';\r\nimport { usersAPI } from './api';\r\n\r\nexport const AuthContext = createContext();\r\n\r\nexport function AuthProvider({ children }) {\r\n  const [user, setUser] = useState(null);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n\r\n  useEffect(() => {\r\n    // Page yüklendiğinde user bilgisini localStorage'dan geri yükle\r\n    const userId = localStorage.getItem('user_id');\r\n    const username = localStorage.getItem('username');\r\n    if (userId && username) {\r\n      setUser({ id: parseInt(userId), username: username });\r\n    }\r\n    \r\n    // CSRF token'ı her zaman al (başlangıçta ve login sonrasında)\r\n    fetch('http://localhost:8000/api/csrf-token/')\r\n      .then(res => res.json())\r\n      .then(data => {\r\n        if (data.csrfToken) {\r\n          localStorage.setItem('csrfToken', data.csrfToken);\r\n        }\r\n      })\r\n      .catch(err => console.warn('CSRF token alınamadı:', err));\r\n    \r\n    setIsLoading(false);\r\n  }, []);\r\n\r\n  const login = async (username, password) => {\r\n    try {\r\n      const response = await usersAPI.login(username, password);\r\n      // Backend user bilgisini döndüğü için bunu sakla\r\n      setUser(response.data);\r\n      localStorage.setItem('user_id', response.data.id);\r\n      localStorage.setItem('username', response.data.username);\r\n      \r\n      // CSRF token'ı al\r\n      try {\r\n        const csrfResponse = await fetch('http://localhost:8000/api/csrf-token/');\r\n        const csrfData = await csrfResponse.json();\r\n        if (csrfData.csrfToken) {\r\n          localStorage.setItem('csrfToken', csrfData.csrfToken);\r\n        }\r\n      } catch (csrfError) {\r\n        console.warn('CSRF token alınamadı:', csrfError);\r\n      }\r\n      \r\n      return true;\r\n    } catch (error) {\r\n      console.error('Giriş hatası:', error.response?.data || error.message);\r\n      return false;\r\n    }\r\n  };\r\n\r\n  const register = async (data) => {\r\n    try {\r\n      const response = await usersAPI.register(data);\r\n      // Kaydolduktan hemen sonra login yap\r\n      setUser(response.data);\r\n      localStorage.setItem('user_id', response.data.id);\r\n      localStorage.setItem('username', response.data.username);\r\n      return true;\r\n    } catch (error) {\r\n      console.error('Kayıt hatası:', error.response?.data || error.message);\r\n      return false;\r\n    }\r\n  };\r\n\r\n  const logout = () => {\r\n    // Session-based auth olduğu için localStorage'ı temizle\r\n    localStorage.removeItem('user_id');\r\n    localStorage.removeItem('username');\r\n    localStorage.removeItem('access_token');\r\n    setUser(null);\r\n  };\r\n\r\n  return (\r\n    <AuthContext.Provider value={{ user, isLoading, login, register, logout }}>\r\n      {children}\r\n    </AuthContext.Provider>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}